
 --================statement 1================ 
DELETE FROM AU_ITG.ITG_PERENSO_FSSI_SALES
WHERE
  SPLIT_PART(FILE_NAME, '.', 1) = '"+((String)globalMap.get("name_from_file"))+"';

 --================statement 2================ 
INSERT INTO AU_ITG.ITG_PERENSO_FSSI_SALES
SELECT
  ETD.CAL_DT,
  ETD.JJ_MNTH_ID,
  FSSI.*,
  CURRENT_TIMESTAMP() AS CRTD_DT,
  CURRENT_TIMESTAMP() AS UPDT_DT
FROM (
  SELECT
    CAST(SPLIT_PART(FILE_NAME, ' ', 3) AS DECIMAL) AS JJ_WEEK,
    CAST(RIGHT(SPLIT_PART(FILE_NAME, '.', 1), 4) AS DECIMAL) AS JJ_YEAR,
    ARTICLE,
    ARTICLE_DESCRIPTION,
    OLD_ARTICLE_NUM,
    EAN AS PROD_EAN,
    SHIP_TO_STORE AS STORE_CD,
    STORE_NAME,
    SALES_VOLUME AS SLS_UNIT,
    SALES_VALUE AS SLS_VALUE,
    'NZD' AS CRNCY,
    FILE_NAME
  FROM AU_SDL.SDL_PERENSO_FSSI_SALES
) AS FSSI
LEFT JOIN (
  SELECT
    MAX(CAL_DATE) AS CAL_DT,
    JJ_WK,
    JJ_MNTH_ID,
    JJ_YEAR
  FROM AU_EDW.EDW_TIME_DIM
  GROUP BY
    JJ_WK,
    JJ_MNTH_ID,
    JJ_YEAR
) AS ETD
  ON FSSI.JJ_WEEK = ETD.JJ_WK AND FSSI.JJ_YEAR = ETD.JJ_YEAR;
