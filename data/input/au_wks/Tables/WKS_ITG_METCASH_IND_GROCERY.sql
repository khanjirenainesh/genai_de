
 --================statement 1================ 
/* Row to column Transpose for week dates */ /* Step 1: create a table which has file name & week end dates */ /* remove the header records in SDL */
DELETE FROM AU_SDL.SDL_METCASH_IND_GROCERY
WHERE
  TRIM(SUPP_ID || SUPP_NAME || STATE || BANNER_ID || BANNER || CUSTOMER_ID || CUSTOMER) IS NULL;

 --================statement 2================ 
/* merge week dates with the sales data */
DROP TABLE IF EXISTS AU_WKS.WKS_ITG_METCASH_IND_GROCERY;

 --================statement 3================ 
CREATE TABLE AU_WKS.WKS_ITG_METCASH_IND_GROCERY AS
(
  SELECT
    TO_DATE(WEEK_END_DT, 'DD/MM/YYYY') AS WEEK_END_DT,
    SUPP_ID,
    SUPP_NAME,
    STATE,
    BANNER_ID,
    BANNER,
    CUSTOMER_ID,
    CUSTOMER,
    PRODUCT_ID,
    PRODUCT,
    CAST(GROSS_SALES_WK1 AS FLOAT) AS GROSS_SALES,
    CAST(GROSS_CASES_WK1 AS FLOAT) AS GROSS_CASES,
    A.FILE_NAME,
    RUN_ID,
    CREATE_DT
  FROM (
    SELECT
      *
    FROM AU_SDL.SDL_METCASH_IND_GROCERY
    WHERE
      GROSS_SALES_WK1 <> 0 AND NOT TRIM(GROSS_SALES_WK1) IS NULL
  ) AS A
  JOIN (
    SELECT
      FILE_NAME,
      GROSS_SALES_WK1 AS WEEK_END_DT
    FROM AU_WKS.WKS_METCASH_GROCERY_DATE
  ) AS B
    ON A.FILE_NAME = B.FILE_NAME /* WEEK 2 data mapping & conversion        */
  UNION ALL
  SELECT
    TO_DATE(WEEK_END_DT, 'DD/MM/YYYY') AS WEEK_END_DT,
    SUPP_ID,
    SUPP_NAME,
    STATE,
    BANNER_ID,
    BANNER,
    CUSTOMER_ID,
    CUSTOMER,
    PRODUCT_ID,
    PRODUCT,
    CAST(GROSS_SALES_WK2 AS FLOAT) AS GROSS_SALES,
    CAST(GROSS_CASES_WK2 AS FLOAT) AS GROSS_CASES,
    A.FILE_NAME,
    RUN_ID,
    CREATE_DT
  FROM (
    SELECT
      *
    FROM AU_SDL.SDL_METCASH_IND_GROCERY
    WHERE
      GROSS_SALES_WK2 <> 0 AND NOT TRIM(GROSS_SALES_WK2) IS NULL
  ) AS A
  JOIN (
    SELECT
      FILE_NAME,
      GROSS_SALES_WK2 AS WEEK_END_DT
    FROM AU_WKS.WKS_METCASH_GROCERY_DATE
  ) AS B
    ON A.FILE_NAME = B.FILE_NAME /* WEEK 3 data mapping & conversion */
  UNION ALL
  SELECT
    TO_DATE(WEEK_END_DT, 'DD/MM/YYYY') AS WEEK_END_DT,
    SUPP_ID,
    SUPP_NAME,
    STATE,
    BANNER_ID,
    BANNER,
    CUSTOMER_ID,
    CUSTOMER,
    PRODUCT_ID,
    PRODUCT,
    CAST(GROSS_SALES_WK3 AS FLOAT) AS GROSS_SALES,
    CAST(GROSS_CASES_WK3 AS FLOAT) AS GROSS_CASES,
    A.FILE_NAME,
    RUN_ID,
    CREATE_DT
  FROM (
    SELECT
      *
    FROM AU_SDL.SDL_METCASH_IND_GROCERY
    WHERE
      GROSS_SALES_WK3 <> 0 AND NOT TRIM(GROSS_SALES_WK3) IS NULL
  ) AS A
  JOIN (
    SELECT
      FILE_NAME,
      GROSS_SALES_WK3 AS WEEK_END_DT
    FROM AU_WKS.WKS_METCASH_GROCERY_DATE
  ) AS B
    ON A.FILE_NAME = B.FILE_NAME /* WEEK 4 data mapping & conversion */
  UNION ALL
  SELECT
    TO_DATE(WEEK_END_DT, 'DD/MM/YYYY') AS WEEK_END_DT,
    SUPP_ID,
    SUPP_NAME,
    STATE,
    BANNER_ID,
    BANNER,
    CUSTOMER_ID,
    CUSTOMER,
    PRODUCT_ID,
    PRODUCT,
    CAST(GROSS_SALES_WK4 AS FLOAT) AS GROSS_SALES,
    CAST(GROSS_CASES_WK4 AS FLOAT) AS GROSS_CASES,
    A.FILE_NAME,
    RUN_ID,
    CREATE_DT
  FROM (
    SELECT
      *
    FROM AU_SDL.SDL_METCASH_IND_GROCERY
    WHERE
      GROSS_SALES_WK4 <> 0 AND NOT TRIM(GROSS_SALES_WK4) IS NULL
  ) AS A
  JOIN (
    SELECT
      FILE_NAME,
      GROSS_SALES_WK4 AS WEEK_END_DT
    FROM AU_WKS.WKS_METCASH_GROCERY_DATE
  ) AS B
    ON A.FILE_NAME = B.FILE_NAME /* WEEK 5 data mapping & conversion        */
  UNION ALL
  SELECT
    TO_DATE(WEEK_END_DT, 'DD/MM/YYYY') AS WEEK_END_DT,
    SUPP_ID,
    SUPP_NAME,
    STATE,
    BANNER_ID,
    BANNER,
    CUSTOMER_ID,
    CUSTOMER,
    PRODUCT_ID,
    PRODUCT,
    CAST(GROSS_SALES_WK5 AS FLOAT) AS GROSS_SALES,
    CAST(GROSS_CASES_WK5 AS FLOAT) AS GROSS_CASES,
    A.FILE_NAME,
    RUN_ID,
    CREATE_DT
  FROM (
    SELECT
      *
    FROM AU_SDL.SDL_METCASH_IND_GROCERY
    WHERE
      GROSS_SALES_WK5 <> 0 AND NOT TRIM(GROSS_SALES_WK5) IS NULL
  ) AS A
  JOIN (
    SELECT
      FILE_NAME,
      GROSS_SALES_WK5 AS WEEK_END_DT
    FROM AU_WKS.WKS_METCASH_GROCERY_DATE
  ) AS B
    ON A.FILE_NAME = B.FILE_NAME
);
