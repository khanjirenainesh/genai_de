
 --================statement 1================ 
DELETE   AU_EDW.EDW_PERENSO_PROD_DIM;

 --================statement 2================ 
/* */ /* COMMIT; */
INSERT INTO AU_EDW.edw_perenso_prod_dim (
  PROD_KEY,
  PROD_DESC,
  PROD_ID,
  PROD_EAN,
  PROD_JJ_FRANCHISE,
  PROD_JJ_CATEGORY,
  PROD_JJ_BRAND,
  PROD_SAP_FRANCHISE,
  PROD_SAP_PROFIT_CENTRE,
  PROD_SAP_PRODUCT_MAJOR,
  PROD_GROCERY_FRANCHISE,
  PROD_GROCERY_CATEGORY,
  PROD_GROCERY_BRAND,
  PROD_ACTIVE_NZ_PHARMA,
  PROD_ACTIVE_AU_GROCERY,
  PROD_ACTIVE_METCASH,
  PROD_ACTIVE_NZ_GROCERY,
  PROD_ACTIVE_AU_PHARMA,
  PROD_PBS,
  PROD_IMS_BRAND,
  PROD_NZ_CODE,
  PROD_METCASH_CODE,
  PROD_OLD_ID,
  PROD_OLD_EAN,
  PROD_TAX,
  PROD_BWP_AUD,
  PROD_BWP_NZD
)
SELECT
  IPP.PROD_KEY as PROD_KEY,
  IPP.PROD_DESC as PROD_DESC,
  IPP.PROD_ID as PROD_ID,
  IPP.PROD_EAN as PROD_EAN,
  COALESCE(GRP.PROD_JJ_FRANCHISE, 'NOT ASSIGNED') AS PROD_JJ_FRANCHISE,
  COALESCE(GRP.PROD_JJ_CATEGORY, 'NOT ASSIGNED') AS PROD_JJ_CATEGORY,
  COALESCE(GRP.PROD_JJ_BRAND, 'NOT ASSIGNED') AS PROD_JJ_BRAND,
  COALESCE(GRP.PROD_SAP_FRANCHISE, 'NOT ASSIGNED') AS PROD_SAP_FRANCHISE,
  COALESCE(GRP.PROD_SAP_PROFIT_CENTRE, 'NOT ASSIGNED') AS PROD_SAP_PROFIT_CENTRE,
  COALESCE(GRP.PROD_SAP_PRODUCT_MAJOR, 'NOT ASSIGNED') AS PROD_SAP_PRODUCT_MAJOR,
  COALESCE(GRP.PROD_GROCERY_FRANCHISE, 'NOT ASSIGNED') AS PROD_GROCERY_FRANCHISE,
  COALESCE(GRP.PROD_GROCERY_CATEGORY, 'NOT ASSIGNED') AS PROD_GROCERY_CATEGORY,
  COALESCE(GRP.PROD_GROCERY_BRAND, 'NOT ASSIGNED') AS PROD_GROCERY_BRAND,
  COALESCE(GRP.PROD_ACTIVE_NZ_PHARMA, 'NOT ASSIGNED') AS PROD_ACTIVE_NZ_PHARMA,
  COALESCE(GRP.PROD_ACTIVE_AU_GROCERY, 'NOT ASSIGNED') AS PROD_ACTIVE_AU_GROCERY,
  COALESCE(GRP.PROD_ACTIVE_METCASH, 'NOT ASSIGNED') AS PROD_ACTIVE_METCASH,
  COALESCE(GRP.PROD_ACTIVE_NZ_GROCERY, 'NOT ASSIGNED') AS PROD_ACTIVE_NZ_GROCERY,
  COALESCE(GRP.PROD_ACTIVE_AU_PHARMA, 'NOT ASSIGNED') AS PROD_ACTIVE_AU_PHARMA,
  COALESCE(GRP.PROD_PBS, 'NOT ASSIGNED') AS PROD_PBS,
  COALESCE(GRP.PROD_IMS_BRAND, 'NOT ASSIGNED') AS PROD_IMS_BRAND,
  COALESCE(GRP.PROD_NZ_CODE, 'NOT ASSIGNED') AS PROD_NZ_CODE,
  COALESCE(GRP.PROD_METCASH_CODE, 'NOT ASSIGNED') AS PROD_METCASH_CODE,
  COALESCE(GRP.PROD_OLD_ID, 'NOT ASSIGNED') AS PROD_OLD_ID,
  COALESCE(GRP.PROD_OLD_EAN, 'NOT ASSIGNED') AS PROD_OLD_EAN,
  COALESCE(GRP.PROD_TAX, 'NOT ASSIGNED') AS PROD_TAX,
  COALESCE(GRP.PROD_BWP_AUD, 'NOT ASSIGNED') AS PROD_BWP_AUD,
  COALESCE(GRP.PROD_BWP_NZD, 'NOT ASSIGNED') AS PROD_BWP_NZD
FROM (
  SELECT
    WPAI.PROD_KEY,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_JJ_FRANCHISE'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_JJ_FRANCHISE,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_JJ_CATEGORY'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_JJ_CATEGORY,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_JJ_BRAND'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_JJ_BRAND,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_SAP_FRANCHISE'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_SAP_FRANCHISE,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_SAP_PROFIT_CENTRE'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_SAP_PROFIT_CENTRE,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_SAP_PRODUCT_MAJOR'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_SAP_PRODUCT_MAJOR,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_GROCERY_FRANCHISE'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_GROCERY_FRANCHISE,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_GROCERY_CATEGORY'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_GROCERY_CATEGORY,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_GROCERY_BRAND'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_GROCERY_BRAND,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_ACTIVE_NZ_PHARMA'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_ACTIVE_NZ_PHARMA,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_ACTIVE_AU_GROCERY'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_ACTIVE_AU_GROCERY,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_ACTIVE_METCASH'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_ACTIVE_METCASH,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_ACTIVE_NZ_GROCERY'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_ACTIVE_NZ_GROCERY,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_ACTIVE_AU_PHARMA'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_ACTIVE_AU_PHARMA,
    MAX(
      CASE WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_PBS' THEN WPAI.PROD_GRP_DESC ELSE NULL END
    ) AS PROD_PBS,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_IMS_BRAND'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_IMS_BRAND,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_NZ_CODE'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_NZ_CODE,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_METCASH_CODE'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_METCASH_CODE,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_OLD_ID'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_OLD_ID,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_OLD_EAN'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_OLD_EAN,
    MAX(
      CASE WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_TAX' THEN WPAI.PROD_GRP_DESC ELSE NULL END
    ) AS PROD_TAX,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_BWP_AUD'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_BWP_AUD,
    MAX(
      CASE
        WHEN UPPER(WPPM.COLUMN_NAME) = 'PROD_BWP_NZD'
        THEN WPAI.PROD_GRP_DESC
        ELSE NULL
      END
    ) AS PROD_BWP_NZD
  FROM AU_ITG.ITG_PERENSO_PROD_MAPPING AS WPPM, AU_WKS.WKS_PERENSO_PROD_INTERMIDEATE AS WPAI
  WHERE
    WPPM.FIELD_KEY = WPAI.FIELD_KEY()
    AND WPPM.PROD_GRP_LEV_KEY = WPAI.PROD_GRP_LEV_KEY()
    AND WPPM.PROD_GRP_KEY = WPAI.PROD_GRP_KEY()
  GROUP BY
    WPAI.PROD_KEY
) AS GRP, AU_ITG.ITG_PERENSO_PRODUCT AS IPP
WHERE
  IPP.PROD_KEY = GRP.PROD_KEY;



prod_key number(10,0),
prod_desc varchar(100),
prod_id varchar(50),
prod_ean varchar(50),
prod_jj_franchise varchar(100),
prod_jj_category varchar(100),
prod_jj_brand varchar(100),
prod_sap_franchise varchar(100),
prod_sap_profit_centre varchar(100),
prod_sap_product_major varchar(100),
prod_grocery_franchise varchar(100),
prod_grocery_category varchar(100),
prod_grocery_brand varchar(100),
prod_active_nz_pharma varchar(100),
prod_active_au_grocery varchar(100),
prod_active_metcash varchar(100),
prod_active_nz_grocery varchar(100),
prod_active_au_pharma varchar(100),
prod_pbs varchar(100),
prod_ims_brand varchar(100),
prod_nz_code varchar(100),
prod_metcash_code varchar(100),
prod_old_id varchar(50),
prod_old_ean varchar(50),
prod_tax varchar(50),
prod_bwp_aud varchar(50),
prod_bwp_nzd varchar(50)